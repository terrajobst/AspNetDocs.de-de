---
uid: mvc/overview/getting-started/introduction/adding-a-new-field
title: Hinzufügen eines neuen Felds | Microsoft-Dokumentation
author: Rick-Anderson
description: ''
ms.author: riande
ms.date: 10/17/2013
ms.assetid: 4085de68-d243-4378-8a64-86236ea8d2da
msc.legacyurl: /mvc/overview/getting-started/introduction/adding-a-new-field
msc.type: authoredcontent
ms.openlocfilehash: 5974e53e4610dccc7812df261dc97a9b0327de85
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78470931"
---
# <a name="adding-a-new-field"></a><span data-ttu-id="8511d-102">Hinzufügen eines neuen Felds</span><span class="sxs-lookup"><span data-stu-id="8511d-102">Adding a New Field</span></span>

<span data-ttu-id="8511d-103">von [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="8511d-103">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

[!INCLUDE [Tutorial Note](index.md)]

<span data-ttu-id="8511d-104">In diesem Abschnitt verwenden Sie Entity Framework Code First-Migrationen, um einige Änderungen an den Modellklassen zu migrieren, sodass die Änderung auf die Datenbank angewendet wird.</span><span class="sxs-lookup"><span data-stu-id="8511d-104">In this section you'll use Entity Framework Code First Migrations to migrate some changes to the model classes so the change is applied to the database.</span></span>

<span data-ttu-id="8511d-105">Wenn Sie Entity Framework Code First verwenden, um automatisch eine Datenbank zu erstellen, wie in diesem Tutorial bereits erwähnt, fügt Code First der Datenbank eine Tabelle hinzu, um zu verfolgen, ob das Schema der Datenbank mit den Modellklassen synchronisiert ist, von denen es generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="8511d-105">By default, when you use Entity Framework Code First to automatically create a database, as you did earlier in this tutorial, Code First adds a table to the database to help track whether the schema of the database is in sync with the model classes it was generated from.</span></span> <span data-ttu-id="8511d-106">Wenn Sie nicht synchron sind, löst die Entity Framework einen Fehler aus.</span><span class="sxs-lookup"><span data-stu-id="8511d-106">If they aren't in sync, the Entity Framework throws an error.</span></span> <span data-ttu-id="8511d-107">Dies vereinfacht das Auffinden von Problemen bei der Entwicklung, die Sie möglicherweise zur Laufzeit nur (aufgrund von unkomplizierter Fehlern) finden.</span><span class="sxs-lookup"><span data-stu-id="8511d-107">This makes it easier to track down issues at development time that you might otherwise only find (by obscure errors) at run time.</span></span>

## <a name="setting-up-code-first-migrations-for-model-changes"></a><span data-ttu-id="8511d-108">Einrichten von Code First-Migrationen für Modelländerungen</span><span class="sxs-lookup"><span data-stu-id="8511d-108">Setting up Code First Migrations for Model Changes</span></span>

<span data-ttu-id="8511d-109">Navigieren Sie zu Projektmappen-Explorer.</span><span class="sxs-lookup"><span data-stu-id="8511d-109">Navigate to Solution Explorer.</span></span> <span data-ttu-id="8511d-110">Klicken Sie mit der rechten Maustaste auf die Datei " *Movies. mdf* ", und wählen Sie **Löschen** aus, um die Datei</span><span class="sxs-lookup"><span data-stu-id="8511d-110">Right click on the *Movies.mdf* file and select **Delete** to remove the movies database.</span></span> <span data-ttu-id="8511d-111">Wenn die Datei *Movies. mdf* nicht angezeigt wird, klicken Sie auf das Symbol **alle Dateien anzeigen** , das unten in der roten Gliederung angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="8511d-111">If you don't see the *Movies.mdf* file, click on the **Show All Files** icon shown below in the red outline.</span></span>

![](adding-a-new-field/_static/image1.png)

<span data-ttu-id="8511d-112">Erstellen Sie die Anwendung, um sicherzustellen, dass keine Fehler vorliegen.</span><span class="sxs-lookup"><span data-stu-id="8511d-112">Build the application to make sure there are no errors.</span></span>

<span data-ttu-id="8511d-113">Klicken Sie im Menü **Extras** auf **NuGet-Paket-Manager** und dann auf **Paket-Manager-Konsole**.</span><span class="sxs-lookup"><span data-stu-id="8511d-113">From the **Tools** menu, click **NuGet Package Manager** and then **Package Manager Console**.</span></span>

![Pack-Mann hinzufügen](adding-a-new-field/_static/image2.png)

<span data-ttu-id="8511d-115">Geben Sie im Fenster **Paket-Manager-Konsole** an der `PM>` Eingabeaufforderung ein.</span><span class="sxs-lookup"><span data-stu-id="8511d-115">In the **Package Manager Console** window at the `PM>` prompt enter</span></span>

<span data-ttu-id="8511d-116">Enable-Migrationen-contexttykname mvcmovie. Models. muviedbcontext</span><span class="sxs-lookup"><span data-stu-id="8511d-116">Enable-Migrations -ContextTypeName MvcMovie.Models.MovieDBContext</span></span>

![](adding-a-new-field/_static/image3.png)

<span data-ttu-id="8511d-117">Mit dem Befehl **enable-Migrationen** (siehe oben) wird eine *Configuration.cs* -Datei in einem neuen *Migrations* Ordner erstellt.</span><span class="sxs-lookup"><span data-stu-id="8511d-117">The **Enable-Migrations** command (shown above) creates a *Configuration.cs* file in a new *Migrations* folder.</span></span>

![](adding-a-new-field/_static/image4.png)

<span data-ttu-id="8511d-118">Visual Studio öffnet die Datei *Configuration.cs* .</span><span class="sxs-lookup"><span data-stu-id="8511d-118">Visual Studio opens the *Configuration.cs* file.</span></span> <span data-ttu-id="8511d-119">Ersetzen Sie die `Seed`-Methode in der Datei *Configuration.cs* durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="8511d-119">Replace the `Seed` method in the *Configuration.cs* file with the following code:</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample1.cs)]

<span data-ttu-id="8511d-120">Bewegen Sie den Mauszeiger über die rote Wellenlinie unter `Movie`, und klicken Sie auf `Show Potential Fixes` und **dann auf** **mvcmovie. Models.**</span><span class="sxs-lookup"><span data-stu-id="8511d-120">Hover over the red squiggly line under `Movie` and click `Show Potential Fixes` and then click **using** **MvcMovie.Models;**</span></span>

![](adding-a-new-field/_static/image5.png)

<span data-ttu-id="8511d-121">Dadurch wird die folgende using-Anweisung hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="8511d-121">Doing so adds the following using statement:</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample2.cs)]

> [!NOTE]
> 
> <span data-ttu-id="8511d-122">Code First-Migrationen wird die `Seed`-Methode nach jeder Migration aufgerufen (d. h., **Update-Database** wird in der Paket-Manager-Konsole aufgerufen), und diese Methode aktualisiert Zeilen, die bereits eingefügt wurden, oder fügt Sie ein, wenn Sie noch nicht vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="8511d-122">Code First Migrations calls the `Seed` method after every migration (that is, calling **update-database** in the Package Manager Console), and this method updates rows that have already been inserted, or inserts them if they don't exist yet.</span></span>
> 
> <span data-ttu-id="8511d-123">Die [addorupdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) -Methode im folgenden Code führt einen Upsert-Vorgang aus:</span><span class="sxs-lookup"><span data-stu-id="8511d-123">The [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method in the following code performs an "upsert" operation:</span></span>
> 
> [!code-csharp[Main](adding-a-new-field/samples/sample3.cs)]
> 
> <span data-ttu-id="8511d-124">Da die [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) -Methode bei jeder Migration ausgeführt wird, können Sie keine Daten einfügen, da die Zeilen, die Sie hinzufügen möchten, nach der ersten Migration, mit der die Datenbank erstellt wird, bereits vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="8511d-124">Because the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method runs with every migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="8511d-125">Der[Upsert](http://en.wikipedia.org/wiki/Upsert)-Vorgang verhindert Fehler, die auftreten würden, wenn Sie versuchen, eine Zeile einzufügen, die bereits vorhanden ist, aber alle Änderungen an Daten überschreibt, die Sie beim Testen der Anwendung möglicherweise vorgenommen haben.</span><span class="sxs-lookup"><span data-stu-id="8511d-125">The "[upsert](http://en.wikipedia.org/wiki/Upsert)" operation prevents errors that would happen if you try to insert a row that already exists, but it overrides any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="8511d-126">Mit Testdaten in einigen Tabellen sollten Sie dies möglicherweise nicht tun: in einigen Fällen, in denen Sie Daten während des Tests ändern, möchten Sie, dass Ihre Änderungen nach Datenbankaktualisierungen verbleiben.</span><span class="sxs-lookup"><span data-stu-id="8511d-126">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="8511d-127">In diesem Fall möchten Sie einen bedingten Einfügevorgang durchführen: Fügen Sie eine Zeile nur ein, wenn Sie nicht bereits vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="8511d-127">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span>   
> 
> <span data-ttu-id="8511d-128">Der erste Parameter, der an die [addorupdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) -Methode übergeben wird, gibt die Eigenschaft an, mit der überprüft wird, ob eine Zeile bereits vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="8511d-128">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="8511d-129">Für die von Ihnen bereitgestellten testfilmdaten kann die `Title`-Eigenschaft für diesen Zweck verwendet werden, da jeder Titel in der Liste eindeutig ist:</span><span class="sxs-lookup"><span data-stu-id="8511d-129">For the test movie data that you are providing, the `Title` property can be used for this purpose since each title in the list is unique:</span></span>
> 
> [!code-csharp[Main](adding-a-new-field/samples/sample4.cs)]
> 
> <span data-ttu-id="8511d-130">Bei diesem Code wird davon ausgegangen, dass Titel eindeutig sind.</span><span class="sxs-lookup"><span data-stu-id="8511d-130">This code assumes that titles are unique.</span></span> <span data-ttu-id="8511d-131">Wenn Sie einen doppelten Titel manuell hinzufügen, erhalten Sie die folgende Ausnahme, wenn Sie das nächste Mal eine Migration ausführen.</span><span class="sxs-lookup"><span data-stu-id="8511d-131">If you manually add a duplicate title, you'll get the following exception the next time you perform a migration.</span></span>   
> 
> <span data-ttu-id="8511d-132">*Die Sequenz enthält mehr als ein Element.*</span><span class="sxs-lookup"><span data-stu-id="8511d-132">*Sequence contains more than one element*</span></span>  
> 
> <span data-ttu-id="8511d-133">Weitere Informationen zur [addorupdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) -Methode finden Sie unter [Übernehmen der addorupdate-Methode von EF 4,3](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/).</span><span class="sxs-lookup"><span data-stu-id="8511d-133">For more information about the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/)..</span></span>

<span data-ttu-id="8511d-134">**Drücken Sie STRG + UMSCHALT + B, um das Projekt zu erstellen.** (Die folgenden Schritte schlagen fehl, wenn Sie zu diesem Zeitpunkt nicht erstellt werden.)</span><span class="sxs-lookup"><span data-stu-id="8511d-134">**Press CTRL-SHIFT-B to build the project.**(The following steps will fail if you don't build at this point.)</span></span>

<span data-ttu-id="8511d-135">Der nächste Schritt ist das Erstellen einer `DbMigration`-Klasse für die erste Migration.</span><span class="sxs-lookup"><span data-stu-id="8511d-135">The next step is to create a `DbMigration` class for the initial migration.</span></span> <span data-ttu-id="8511d-136">Bei dieser Migration wird eine neue Datenbank erstellt. aus diesem Grund haben Sie die Datei " *Movie. mdf* " in einem vorherigen Schritt gelöscht.</span><span class="sxs-lookup"><span data-stu-id="8511d-136">This migration creates a new database, that's why you deleted the *movie.mdf* file in a previous step.</span></span>

<span data-ttu-id="8511d-137">Geben Sie im Fenster **Paket-Manager-Konsole** den Befehl `add-migration Initial` ein, um die anfängliche Migration zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8511d-137">In the **Package Manager Console** window, enter the command `add-migration Initial` to create the initial migration.</span></span> <span data-ttu-id="8511d-138">Der Name "Initial" ist willkürlich und wird zum Benennen der erstellten Migrations Datei verwendet.</span><span class="sxs-lookup"><span data-stu-id="8511d-138">The name "Initial" is arbitrary and is used to name the migration file created.</span></span>

![](adding-a-new-field/_static/image6.png)

<span data-ttu-id="8511d-139">Code First-Migrationen erstellt eine andere Klassendatei im *Migrations* Ordner (mit dem Namen *{DATESTAMP}\_Initial.cs* ), und diese Klasse enthält Code, der das Datenbankschema erstellt.</span><span class="sxs-lookup"><span data-stu-id="8511d-139">Code First Migrations creates another class file in the *Migrations* folder (with the name *{DateStamp}\_Initial.cs* ), and this class contains code that creates the database schema.</span></span> <span data-ttu-id="8511d-140">Der Dateiname der Migration ist mit einem Zeitstempel versehen, um die Reihenfolge zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8511d-140">The migration filename is pre-fixed with a timestamp to help with ordering.</span></span> <span data-ttu-id="8511d-141">Untersuchen Sie die Datei " *{DATESTAMP}\_Initial.cs* ", die die Anweisungen zum Erstellen der `Movies` Tabelle für die Movie DB enthält.</span><span class="sxs-lookup"><span data-stu-id="8511d-141">Examine the *{DateStamp}\_Initial.cs* file, it contains the instructions to create the `Movies` table for the Movie DB.</span></span> <span data-ttu-id="8511d-142">Wenn Sie die Datenbank in den folgenden Anweisungen aktualisieren, wird die Datei " *{DATESTAMP}\_Initial.cs* " ausgeführt und das Datenbankschema erstellt.</span><span class="sxs-lookup"><span data-stu-id="8511d-142">When you update the database in the instructions below, this *{DateStamp}\_Initial.cs* file will run and create the DB schema.</span></span> <span data-ttu-id="8511d-143">Anschließend wird die **Seed** -Methode ausgeführt, um die Datenbank mit Testdaten aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="8511d-143">Then the **Seed** method will run to populate the DB with test data.</span></span>

<span data-ttu-id="8511d-144">Geben Sie in der **Paket-Manager-Konsole**den Befehl `update-database`, um die Datenbank zu erstellen, und führen Sie die `Seed`-Methode aus.</span><span class="sxs-lookup"><span data-stu-id="8511d-144">In the **Package Manager Console**, enter the command `update-database` to create the database and run the `Seed` method.</span></span>

![](adding-a-new-field/_static/image7.png)

<span data-ttu-id="8511d-145">Wenn Sie eine Fehlermeldung erhalten, die anzeigt, dass eine Tabelle bereits vorhanden und nicht erstellt werden kann, liegt dies wahrscheinlich daran, dass Sie die Anwendung ausgeführt haben, nachdem Sie die Datenbank gelöscht haben und bevor Sie `update-database`ausgeführt haben.</span><span class="sxs-lookup"><span data-stu-id="8511d-145">If you get an error that indicates a table already exists and can't be created, it is probably because you ran the application after you deleted the database and before you executed `update-database`.</span></span> <span data-ttu-id="8511d-146">Löschen Sie in diesem Fall die Datei " *Movies. mdf* " erneut, und wiederholen Sie den `update-database` Befehl.</span><span class="sxs-lookup"><span data-stu-id="8511d-146">In that case, delete the *Movies.mdf* file again and retry the `update-database` command.</span></span> <span data-ttu-id="8511d-147">Wenn weiterhin eine Fehlermeldung angezeigt wird, löschen Sie den Ordner "Migrationen" und den Inhalt, und beginnen Sie mit den Anweisungen am oberen Rand dieser Seite (Löschen Sie die Datei " *Movies. mdf* ", und fahren Sie dann mit enable-Migrationen fort).</span><span class="sxs-lookup"><span data-stu-id="8511d-147">If you still get an error, delete the migrations folder and contents then start with the instructions at the top of this page (that is delete the *Movies.mdf* file then proceed to Enable-Migrations).</span></span> <span data-ttu-id="8511d-148">Wenn Sie weiterhin einen Fehler erhalten, öffnen Sie SQL Server-Objekt-Explorer, und entfernen Sie die Datenbank aus der Liste.</span><span class="sxs-lookup"><span data-stu-id="8511d-148">If you still get an error, open SQL Server Object Explorer and remove the database from the list.</span></span>

<span data-ttu-id="8511d-149">Führen Sie die Anwendung aus, und navigieren Sie zur URL */Movies* .</span><span class="sxs-lookup"><span data-stu-id="8511d-149">Run the application and navigate to the */Movies* URL.</span></span> <span data-ttu-id="8511d-150">Die Seed-Daten werden angezeigt.</span><span class="sxs-lookup"><span data-stu-id="8511d-150">The seed data is displayed.</span></span>

![](adding-a-new-field/_static/image8.png)

## <a name="adding-a-rating-property-to-the-movie-model"></a><span data-ttu-id="8511d-151">Hinzufügen einer Rating-Eigenschaft zum Movie-Modell</span><span class="sxs-lookup"><span data-stu-id="8511d-151">Adding a Rating Property to the Movie Model</span></span>

<span data-ttu-id="8511d-152">Beginnen Sie, indem Sie der vorhandenen `Movie` Klasse eine neue `Rating`-Eigenschaft hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="8511d-152">Start by adding a new `Rating` property to the existing `Movie` class.</span></span> <span data-ttu-id="8511d-153">Öffnen Sie die Datei *models\muvie.cs* , und fügen Sie die `Rating`-Eigenschaft wie folgt hinzu:</span><span class="sxs-lookup"><span data-stu-id="8511d-153">Open the *Models\Movie.cs* file and add the `Rating` property like this one:</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample5.cs)]

<span data-ttu-id="8511d-154">Die gesamte `Movie`-Klasse sieht nun wie der folgende Code aus:</span><span class="sxs-lookup"><span data-stu-id="8511d-154">The complete `Movie` class now looks like the following code:</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample6.cs?highlight=12)]

<span data-ttu-id="8511d-155">Erstellen Sie die Anwendung (STRG + UMSCHALT + B).</span><span class="sxs-lookup"><span data-stu-id="8511d-155">Build the application (Ctrl+Shift+B).</span></span>

<span data-ttu-id="8511d-156">Da Sie der `Movie`-Klasse ein neues Feld hinzugefügt haben, müssen Sie auch die Bindungs- *weißen Liste* aktualisieren, damit diese neue Eigenschaft eingeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="8511d-156">Because you've added a new field to the `Movie` class, you also need to update the binding *white list* so this new property will be included.</span></span> <span data-ttu-id="8511d-157">Aktualisieren Sie das `bind`-Attribut für `Create` und `Edit` Aktionsmethoden, um die `Rating`-Eigenschaft einzuschließen:</span><span class="sxs-lookup"><span data-stu-id="8511d-157">Update the `bind` attribute for `Create` and `Edit` action methods to include the `Rating` property:</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample7.cs?highlight=1)]

<span data-ttu-id="8511d-158">Sie müssen auch die Ansichtsvorlagen aktualisieren, um die neue `Rating`-Eigenschaft in der Browseransicht anzuzeigen, zu erstellen und zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="8511d-158">You also need to update the view templates in order to display, create and edit the new `Rating` property in the browser view.</span></span>

<span data-ttu-id="8511d-159">Öffnen Sie die Datei " *\views\movies\index.cshtml* ", und fügen Sie eine `<th>Rating</th>` Spaltenüberschrift direkt hinter der **Preis** Spalte ein.</span><span class="sxs-lookup"><span data-stu-id="8511d-159">Open the *\Views\Movies\Index.cshtml* file and add a `<th>Rating</th>` column heading just after the **Price** column.</span></span> <span data-ttu-id="8511d-160">Fügen Sie dann am Ende der Vorlage eine `<td>` Spalte hinzu, um den `@item.Rating` Wert zu erzeugen.</span><span class="sxs-lookup"><span data-stu-id="8511d-160">Then add a `<td>` column near the end of the template to render the `@item.Rating` value.</span></span> <span data-ttu-id="8511d-161">Im folgenden sehen Sie, wie die aktualisierte Vorlage " *Index. cshtml* " angezeigt wird:</span><span class="sxs-lookup"><span data-stu-id="8511d-161">Below is what the updated *Index.cshtml* view template looks like:</span></span>

[!code-cshtml[Main](adding-a-new-field/samples/sample8.cshtml?highlight=31-33,52-54)]

<span data-ttu-id="8511d-162">Öffnen Sie als nächstes die Datei " *\views\movies\kreate.cshtml* ", und fügen Sie das Feld "`Rating`" mit dem folgenden markierten Markup hinzu.</span><span class="sxs-lookup"><span data-stu-id="8511d-162">Next, open the *\Views\Movies\Create.cshtml* file and add the `Rating` field with the following highlighted markup.</span></span> <span data-ttu-id="8511d-163">Dadurch wird ein Textfeld gerendert, sodass Sie beim Erstellen eines neuen Films eine Bewertung angeben können.</span><span class="sxs-lookup"><span data-stu-id="8511d-163">This renders a text box so that you can specify a rating when a new movie is created.</span></span>

[!code-cshtml[Main](adding-a-new-field/samples/sample9.cshtml?highlight=9-15)]

<span data-ttu-id="8511d-164">Sie haben nun den Anwendungscode aktualisiert, um die neue `Rating`-Eigenschaft zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8511d-164">You've now updated the application code to support the new `Rating` property.</span></span>

<span data-ttu-id="8511d-165">Führen Sie die Anwendung aus, und navigieren Sie zur URL */Movies* .</span><span class="sxs-lookup"><span data-stu-id="8511d-165">Run the application and navigate to the */Movies* URL.</span></span> <span data-ttu-id="8511d-166">Wenn Sie dies jedoch tun, wird einer der folgenden Fehler angezeigt:</span><span class="sxs-lookup"><span data-stu-id="8511d-166">When you do this, though, you'll see one of the following errors:</span></span>

![](adding-a-new-field/_static/image9.png)  
  
<span data-ttu-id="8511d-167">Das Modell, das den Kontext "Kontext" unterstützt, hat sich seit der Erstellung der Datenbank geändert.</span><span class="sxs-lookup"><span data-stu-id="8511d-167">The model backing the 'MovieDBContext' context has changed since the database was created.</span></span> <span data-ttu-id="8511d-168">Verwenden Sie Code First-Migrationen, um die Datenbank zu aktualisieren (https://go.microsoft.com/fwlink/?LinkId=238269).</span><span class="sxs-lookup"><span data-stu-id="8511d-168">Consider using Code First Migrations to update the database (https://go.microsoft.com/fwlink/?LinkId=238269).</span></span>

![](adding-a-new-field/_static/image10.png)

<span data-ttu-id="8511d-169">Dieser Fehler wird angezeigt, da die aktualisierte `Movie` Modell Klasse in der Anwendung sich nun von dem Schema der `Movie` Tabelle der vorhandenen Datenbank unterscheidet.</span><span class="sxs-lookup"><span data-stu-id="8511d-169">You're seeing this error because the updated `Movie` model class in the application is now different than the schema of the `Movie` table of the existing database.</span></span> <span data-ttu-id="8511d-170">(Die Datenbanktabelle enthält nicht die Spalte `Rating`.)</span><span class="sxs-lookup"><span data-stu-id="8511d-170">(There's no `Rating` column in the database table.)</span></span>

<span data-ttu-id="8511d-171">Es gibt mehrere Vorgehensweisen zum Beheben des Fehlers:</span><span class="sxs-lookup"><span data-stu-id="8511d-171">There are a few approaches to resolving the error:</span></span>

1. <span data-ttu-id="8511d-172">Lassen Sie die Datenbank von Entity Framework automatisch löschen und basierend auf dem neuen Modellklassenschema neu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8511d-172">Have the Entity Framework automatically drop and re-create the database based on the new model class schema.</span></span> <span data-ttu-id="8511d-173">Dieser Ansatz ist früh im Entwicklungszyklus sehr praktisch, wenn die aktive Entwicklung in einer Testdatenbank erfolgt. Er ermöglicht Ihnen, das Modell und das Datenbankschema schnell weiterzuentwickeln.</span><span class="sxs-lookup"><span data-stu-id="8511d-173">This approach is very convenient early in the development cycle when you are doing active development on a test database; it allows you to quickly evolve the model and database schema together.</span></span> <span data-ttu-id="8511d-174">Der Nachteil besteht jedoch darin, dass Sie vorhandene Daten in der Datenbank verlieren – damit Sie diesen Ansatz *nicht* für eine Produktionsdatenbank verwenden möchten.</span><span class="sxs-lookup"><span data-stu-id="8511d-174">The downside, though, is that you lose existing data in the database — so you *don't* want to use this approach on a production database!</span></span> <span data-ttu-id="8511d-175">Das Verwenden eines Initialisierers zum automatischen Ausführen eines Seedings für eine Datenbank mit Testdaten ist häufig eine produktive Möglichkeit zum Entwickeln einer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="8511d-175">Using an initializer to automatically seed a database with test data is often a productive way to develop an application.</span></span> <span data-ttu-id="8511d-176">Weitere Informationen zu Entity Framework-datenbankinitialisierern finden Sie unter [ASP.NET MVC/Entity Framework Tutorial](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="8511d-176">For more information on Entity Framework database initializers, see [ASP.NET MVC/Entity Framework tutorial](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
2. <span data-ttu-id="8511d-177">Ändern Sie das Schema der vorhandenen Datenbank explizit so, dass es mit den Modellklassen übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="8511d-177">Explicitly modify the schema of the existing database so that it matches the model classes.</span></span> <span data-ttu-id="8511d-178">Der Vorteil dieses Ansatzes ist, dass Sie Ihre Daten behalten.</span><span class="sxs-lookup"><span data-stu-id="8511d-178">The advantage of this approach is that you keep your data.</span></span> <span data-ttu-id="8511d-179">Sie können diese Änderung entweder manuell oder durch Erstellen eines Änderungsskripts für die Datenbank vornehmen.</span><span class="sxs-lookup"><span data-stu-id="8511d-179">You can make this change either manually or by creating a database change script.</span></span>
3. <span data-ttu-id="8511d-180">Verwenden Sie Code First-Migrationen, um das Datenbankschema zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="8511d-180">Use Code First Migrations to update the database schema.</span></span>

<span data-ttu-id="8511d-181">Für dieses Tutorial verwenden wir Code First-Migrationen.</span><span class="sxs-lookup"><span data-stu-id="8511d-181">For this tutorial, we'll use Code First Migrations.</span></span>

<span data-ttu-id="8511d-182">Aktualisieren Sie die Seed-Methode, sodass Sie einen Wert für die neue Spalte bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="8511d-182">Update the Seed method so that it provides a value for the new column.</span></span> <span data-ttu-id="8511d-183">Öffnen Sie die Datei migrations\configuration.cs, und fügen Sie jedem Movie-Objekt ein Bewertungsfeld hinzu.</span><span class="sxs-lookup"><span data-stu-id="8511d-183">Open Migrations\Configuration.cs file and add a Rating field to each Movie object.</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample10.cs?highlight=6)]

<span data-ttu-id="8511d-184">Erstellen Sie die Projekt Mappe, öffnen Sie das Konsolenfenster des **Paket-Managers** , und geben Sie den folgenden Befehl ein:</span><span class="sxs-lookup"><span data-stu-id="8511d-184">Build the solution, and then open the **Package Manager Console** window and enter the following command:</span></span>

`add-migration Rating`

<span data-ttu-id="8511d-185">Der `add-migration` Befehl weist das Migrations Framework an, das aktuelle Movie-Modell mit dem aktuellen Movie DB-Schema zu untersuchen und den erforderlichen Code zum Migrieren der Datenbank zum neuen Modell zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8511d-185">The `add-migration` command tells the migration framework to examine the current movie model with the current movie DB schema and create the necessary code to migrate the DB to the new model.</span></span> <span data-ttu-id="8511d-186">Die namens *Bewertung* ist willkürlich und wird verwendet, um die Migrations Datei zu benennen.</span><span class="sxs-lookup"><span data-stu-id="8511d-186">The name *Rating* is arbitrary and is used to name the migration file.</span></span> <span data-ttu-id="8511d-187">Es ist hilfreich, einen aussagekräftigen Namen für den Migrationsschritt zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="8511d-187">It's helpful to use a meaningful name for the migration step.</span></span>

<span data-ttu-id="8511d-188">Wenn dieser Befehl abgeschlossen ist, öffnet Visual Studio die Klassendatei, die die neue `DbMigration` abgeleitete Klasse definiert, und in der `Up`-Methode sehen Sie den Code, der die neue Spalte erstellt.</span><span class="sxs-lookup"><span data-stu-id="8511d-188">When this command finishes, Visual Studio opens the class file that defines the new `DbMigration` derived class, and in the `Up` method you can see the code that creates the new column.</span></span>

[!code-csharp[Main](adding-a-new-field/samples/sample11.cs)]

<span data-ttu-id="8511d-189">Erstellen Sie die Projekt Mappe, und geben Sie dann den Befehl `update-database` im Fenster **Paket-Manager-Konsole** ein.</span><span class="sxs-lookup"><span data-stu-id="8511d-189">Build the solution, and then enter the `update-database` command in the **Package Manager Console** window.</span></span>

<span data-ttu-id="8511d-190">Die folgende Abbildung zeigt die Ausgabe im Fenster der **Paket-Manager-Konsole** (die *Bewertung* der vorab ausstehenden Datumsstempel ist anders.)</span><span class="sxs-lookup"><span data-stu-id="8511d-190">The following image shows the output in the **Package Manager Console** window (The date stamp prepending *Rating* will be different.)</span></span>

![](adding-a-new-field/_static/image11.png)

<span data-ttu-id="8511d-191">Führen Sie die Anwendung erneut aus, und navigieren Sie zur URL/Movies.</span><span class="sxs-lookup"><span data-stu-id="8511d-191">Re-run the application and navigate to the /Movies URL.</span></span> <span data-ttu-id="8511d-192">Sie können das Feld neue Bewertung sehen.</span><span class="sxs-lookup"><span data-stu-id="8511d-192">You can see the new Rating field.</span></span>

![](adding-a-new-field/_static/image12.png)

<span data-ttu-id="8511d-193">Klicken Sie auf den Link **neu erstellen** , um einen neuen Film hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="8511d-193">Click the **Create New** link to add a new movie.</span></span> <span data-ttu-id="8511d-194">Beachten Sie, dass Sie eine Bewertung hinzufügen können.</span><span class="sxs-lookup"><span data-stu-id="8511d-194">Note that you can add a rating.</span></span>

![7_CreateRioII](adding-a-new-field/_static/image13.png)

<span data-ttu-id="8511d-196">Klicken Sie auf **Erstellen**.</span><span class="sxs-lookup"><span data-stu-id="8511d-196">Click **Create**.</span></span> <span data-ttu-id="8511d-197">Der neue Film, einschließlich der Bewertung, wird jetzt in der Liste der Filme angezeigt:</span><span class="sxs-lookup"><span data-stu-id="8511d-197">The new movie, including the rating, now shows up in the movies listing:</span></span>

![7_ourNewMovie_SM](adding-a-new-field/_static/image14.png)

<span data-ttu-id="8511d-199">Nachdem das Projekt Migrationen verwendet hat, müssen Sie die Datenbank nicht löschen, wenn Sie ein neues Feld hinzufügen oder das Schema anderweitig aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="8511d-199">Now that the project is using migrations, you won't need to drop the database when you add a new field or otherwise update the schema.</span></span> <span data-ttu-id="8511d-200">Im nächsten Abschnitt nehmen wir weitere Schema Änderungen vor und verwenden Migrationen, um die Datenbank zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="8511d-200">In the next section, we'll make more schema changes and use migrations to update the database.</span></span>

<span data-ttu-id="8511d-201">Sie sollten auch das Feld `Rating` den Vorlagen bearbeiten, Details und Löschen Anzeigen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="8511d-201">You should also add the `Rating` field to the Edit, Details, and Delete view templates.</span></span>

<span data-ttu-id="8511d-202">Sie können den Befehl "Update-Database" erneut im Fenster " **Paket-Manager-Konsole** " eingeben, und es würde kein Migrations Code ausgeführt werden, da das Schema mit dem Modell übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="8511d-202">You could enter the "update-database" command in the **Package Manager Console** window again and no migration code would run, because the schema matches the model.</span></span> <span data-ttu-id="8511d-203">Wenn Sie jedoch "Update-Database" ausführen, wird die `Seed`-Methode erneut ausgeführt, und wenn Sie einen der Seed-Daten geändert haben, gehen die Änderungen verloren, da die `Seed`-Methode Daten aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="8511d-203">However, running "update-database" will run the `Seed` method again, and if you changed any of the Seed data, the changes will be lost because the `Seed` method upserts data.</span></span> <span data-ttu-id="8511d-204">Weitere Informationen zur `Seed`-Methode finden Sie im beliebten [ASP.NET MVC/Entity Framework-Tutorial](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)von Tom Dykstra.</span><span class="sxs-lookup"><span data-stu-id="8511d-204">You can read more about the `Seed` method in Tom Dykstra's popular [ASP.NET MVC/Entity Framework tutorial](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>

<span data-ttu-id="8511d-205">In diesem Abschnitt haben Sie erfahren, wie Sie Modell Objekte ändern und die Datenbank mit den Änderungen synchron halten.</span><span class="sxs-lookup"><span data-stu-id="8511d-205">In this section you saw how you can modify model objects and keep the database in sync with the changes.</span></span> <span data-ttu-id="8511d-206">Sie haben auch gelernt, wie Sie eine neu erstellte Datenbank mit Beispiel Daten auffüllen, um Szenarios ausprobieren zu können.</span><span class="sxs-lookup"><span data-stu-id="8511d-206">You also learned a way to populate a newly created database with sample data so you can try out scenarios.</span></span> <span data-ttu-id="8511d-207">Dies war nur eine kurze Einführung in Code First. eine ausführlichere Anleitung zum Thema finden Sie unter [Erstellen eines Entity Framework Datenmodells für eine ASP.NET MVC-Anwendung](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md) .</span><span class="sxs-lookup"><span data-stu-id="8511d-207">This was just a quick introduction to Code First, see [Creating an Entity Framework Data Model for an ASP.NET MVC Application](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md) for a more complete tutorial on the subject.</span></span> <span data-ttu-id="8511d-208">Als nächstes sehen wir uns an, wie Sie den Modellklassen eine umfassendere Validierungs Logik hinzufügen und einige Geschäftsregeln erzwingen können.</span><span class="sxs-lookup"><span data-stu-id="8511d-208">Next, let's look at how you can add richer validation logic to the model classes and enable some business rules to be enforced.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8511d-209">[Zurück](adding-search.md)
> [Weiter](adding-validation.md)</span><span class="sxs-lookup"><span data-stu-id="8511d-209">[Previous](adding-search.md)
[Next](adding-validation.md)</span></span>
